{"version":3,"file":"esri-leaflet-vector.js","sources":["../src/Util.js","../node_modules/mapbox-gl-leaflet/leaflet-mapbox-gl.js","../src/Basemap.js","../src/Layer.js"],"sourcesContent":["import L from 'leaflet';\nimport 'mapbox-gl';\nimport 'mapbox-gl-leaflet';\nimport { request } from 'esri-leaflet';\n\nexport function fetchMetadata (url, context) {\n  request(url, {}, function (error, style) {\n    if (!error) {\n      request(style.sources.esri.url, {}, function (error, tileMetadata) {\n        if (!error) {\n          formatStyle(style, tileMetadata, url);\n          context._mapboxGL = L.mapboxGL({\n            accessToken: 'ezree',\n            style: style\n          });\n\n          context._ready = true;\n          context.fire('ready', {}, true);\n        }\n      }, context);\n    } else {\n      throw new Error('Unable to fetch vector tile style metadata');\n    }\n  }, context);\n}\n\nexport function formatStyle (style, metadata, styleUrl) {\n  // if a relative path is referenced, the default style can be found in a standard location\n  if (style.sources.esri.url && style.sources.esri.url.indexOf('http') === -1) {\n    style.sources.esri.url = styleUrl.replace('/resources/styles/root.json', '');\n  }\n\n  // right now ArcGIS Pro published vector services have a slightly different signature\n  if (metadata.tiles && metadata.tiles[0].charAt(0) !== '/') {\n    metadata.tiles[0] = '/' + metadata.tiles[0];\n  }\n\n  if (metadata.tileMap && metadata.tileMap.charAt(0) !== '/') {\n    metadata.tileMap = '/' + metadata.tileMap;\n  }\n\n  style.sources.esri = {\n    type: 'vector',\n    scheme: 'xyz',\n    tilejson: metadata.tilejson || '2.0.0',\n    format: (metadata.tileInfo && metadata.tileInfo.format) || 'pbf',\n    index: metadata.tileMap ? style.sources.esri.url + metadata.tileMap : null,\n    tiles: [\n      style.sources.esri.url + metadata.tiles[0]\n    ],\n    description: metadata.description,\n    name: metadata.name\n  };\n\n  if (style.glyphs.indexOf('http') === -1) {\n    // set paths to sprite and glyphs\n    style.glyphs = styleUrl.replace('styles/root.json', style.glyphs.replace('../', ''));\n    style.sprite = styleUrl.replace('styles/root.json', style.sprite.replace('../', ''));\n  }\n}\n\nexport var Util = {\n  fetchMetadata: fetchMetadata,\n  formatStyle: formatStyle\n};\n\nexport default Util;\n","L.MapboxGL = L.Layer.extend({\r\n    options: {\r\n      updateInterval: 32\r\n    },\r\n\r\n    initialize: function (options) {\r\n        L.setOptions(this, options);\r\n\r\n        if (options.accessToken) {\r\n            mapboxgl.accessToken = options.accessToken;\r\n        } else {\r\n            throw new Error('You should provide a Mapbox GL access token as a token option.');\r\n        }\r\n\r\n         /**\r\n         * Create a version of `fn` that only fires once every `time` millseconds.\r\n         *\r\n         * @param {Function} fn the function to be throttled\r\n         * @param {number} time millseconds required between function calls\r\n         * @param {*} context the value of `this` with which the function is called\r\n         * @returns {Function} debounced function\r\n         * @private\r\n         */\r\n        var throttle = function (fn, time, context) {\r\n            var lock, args, wrapperFn, later;\r\n\r\n            later = function () {\r\n                // reset lock and call if queued\r\n                lock = false;\r\n                if (args) {\r\n                    wrapperFn.apply(context, args);\r\n                    args = false;\r\n                }\r\n            };\r\n\r\n            wrapperFn = function () {\r\n                if (lock) {\r\n                    // called too soon, queue to call later\r\n                    args = arguments;\r\n\r\n                } else {\r\n                    // call and lock until later\r\n                    fn.apply(context, arguments);\r\n                    setTimeout(later, time);\r\n                    lock = true;\r\n                }\r\n            };\r\n\r\n            return wrapperFn;\r\n        };\r\n\r\n        // setup throttling the update event when panning\r\n        this._throttledUpdate = throttle(L.Util.bind(this._update, this), this.options.updateInterval);\r\n    },\r\n\r\n    onAdd: function (map) {\r\n        if (!this._glContainer) {\r\n            this._initContainer();\r\n        }\r\n\r\n        map._panes.tilePane.appendChild(this._glContainer);\r\n\r\n        this._initGL();\r\n\r\n        this._offset = this._map.containerPointToLayerPoint([0, 0]);\r\n\r\n        // work around https://github.com/mapbox/mapbox-gl-leaflet/issues/47\r\n        if (map.options.zoomAnimation) {\r\n            L.DomEvent.on(map._proxy, L.DomUtil.TRANSITION_END, this._transitionEnd, this);\r\n        }\r\n    },\r\n\r\n    onRemove: function (map) {\r\n        if (this._map.options.zoomAnimation) {\r\n            L.DomEvent.off(this._map._proxy, L.DomUtil.TRANSITION_END, this._transitionEnd, this);\r\n        }\r\n\r\n        map.getPanes().tilePane.removeChild(this._glContainer);\r\n        this._glMap.remove();\r\n        this._glMap = null;\r\n    },\r\n\r\n    getEvents: function () {\r\n        return {\r\n            move: this._throttledUpdate, // sensibly throttle updating while panning\r\n            zoomanim: this._animateZoom, // applys the zoom animation to the <canvas>\r\n            zoom: this._pinchZoom, // animate every zoom event for smoother pinch-zooming\r\n            zoomstart: this._zoomStart, // flag starting a zoom to disable panning\r\n            zoomend: this._zoomEnd\r\n        };\r\n    },\r\n\r\n    _initContainer: function () {\r\n        var container = this._glContainer = L.DomUtil.create('div', 'leaflet-gl-layer');\r\n\r\n        var size = this._map.getSize();\r\n        container.style.width  = size.x + 'px';\r\n        container.style.height = size.y + 'px';\r\n    },\r\n\r\n    _initGL: function () {\r\n        var center = this._map.getCenter();\r\n\r\n        var options = L.extend({}, this.options, {\r\n            container: this._glContainer,\r\n            interactive: false,\r\n            center: [center.lng, center.lat],\r\n            zoom: this._map.getZoom() - 1,\r\n            attributionControl: false\r\n        });\r\n\r\n        this._glMap = new mapboxgl.Map(options);\r\n\r\n        // allow GL base map to pan beyond min/max latitudes\r\n        this._glMap.transform.latRange = null;\r\n\r\n        if (this._glMap._canvas.canvas) {\r\n            // older versions of mapbox-gl surfaced the canvas differently\r\n            this._glMap._actualCanvas = this._glMap._canvas.canvas;\r\n        } else {\r\n            this._glMap._actualCanvas = this._glMap._canvas;\r\n        }\r\n\r\n        // treat child <canvas> element like L.ImageOverlay\r\n        L.DomUtil.addClass(this._glMap._actualCanvas, 'leaflet-image-layer');\r\n        L.DomUtil.addClass(this._glMap._actualCanvas, 'leaflet-zoom-animated');\r\n\r\n    },\r\n\r\n    _update: function (e) {\r\n        // update the offset so we can correct for it later when we zoom\r\n        this._offset = this._map.containerPointToLayerPoint([0, 0]);\r\n\r\n        if (this._zooming) {\r\n          return;\r\n        }\r\n\r\n        var size = this._map.getSize(),\r\n            container = this._glContainer,\r\n            gl = this._glMap,\r\n            topLeft = this._map.containerPointToLayerPoint([0, 0]);\r\n\r\n        L.DomUtil.setPosition(container, topLeft);\r\n\r\n        var center = this._map.getCenter();\r\n\r\n        // gl.setView([center.lat, center.lng], this._map.getZoom() - 1, 0);\r\n        // calling setView directly causes sync issues because it uses requestAnimFrame\r\n\r\n        var tr = gl.transform;\r\n        tr.center = mapboxgl.LngLat.convert([center.lng, center.lat]);\r\n        tr.zoom = this._map.getZoom() - 1;\r\n\r\n        if (gl.transform.width !== size.x || gl.transform.height !== size.y) {\r\n            container.style.width  = size.x + 'px';\r\n            container.style.height = size.y + 'px';\r\n            if (gl._resize !== null && gl._resize !== undefined){\r\n                gl._resize();\r\n            } else {\r\n                gl.resize();\r\n            }\r\n        } else {\r\n            // older versions of mapbox-gl surfaced update publicly\r\n            if (gl._update !== null && gl._update !== undefined){\r\n                gl._update();\r\n            } else {\r\n                gl.update();\r\n            }\r\n        }\r\n    },\r\n\r\n    // update the map constantly during a pinch zoom\r\n    _pinchZoom: function (e) {\r\n      this._glMap.jumpTo({\r\n        zoom: this._map.getZoom() - 1,\r\n        center: this._map.getCenter()\r\n      });\r\n    },\r\n\r\n    // borrowed from L.ImageOverlay https://github.com/Leaflet/Leaflet/blob/master/src/layer/ImageOverlay.js#L139-L144\r\n    _animateZoom: function (e) {\r\n      var scale = this._map.getZoomScale(e.zoom),\r\n          offset = this._map._latLngToNewLayerPoint(this._map.getBounds().getNorthWest(), e.zoom, e.center);\r\n\r\n      L.DomUtil.setTransform(this._glMap._actualCanvas, offset.subtract(this._offset), scale);\r\n    },\r\n\r\n    _zoomStart: function (e) {\r\n      this._zooming = true;\r\n    },\r\n\r\n    _zoomEnd: function () {\r\n      var scale = this._map.getZoomScale(this._map.getZoom()),\r\n          offset = this._map._latLngToNewLayerPoint(this._map.getBounds().getNorthWest(), this._map.getZoom(), this._map.getCenter());\r\n\r\n      L.DomUtil.setTransform(this._glMap._actualCanvas, offset.subtract(this._offset), scale);\r\n\r\n      this._zooming = false;\r\n    },\r\n\r\n    _transitionEnd: function (e) {\r\n      L.Util.requestAnimFrame(function () {\r\n          var zoom = this._map.getZoom(),\r\n          center = this._map.getCenter(),\r\n          offset = this._map.latLngToContainerPoint(this._map.getBounds().getNorthWest());\r\n\r\n          // reset the scale and offset\r\n          L.DomUtil.setTransform(this._glMap._actualCanvas, offset, 1);\r\n\r\n          // enable panning once the gl map is ready again\r\n          this._glMap.once('moveend', L.Util.bind(function () {\r\n              this._zoomEnd();\r\n          }, this));\r\n\r\n          // update the map position\r\n          this._glMap.jumpTo({\r\n              center: center,\r\n              zoom: zoom - 1\r\n          });\r\n      }, this);\r\n    }\r\n});\r\n\r\nL.mapboxGL = function (options) {\r\n    return new L.MapboxGL(options);\r\n};\r\n","import L from 'leaflet';\nimport { Util } from 'esri-leaflet';\nimport { fetchMetadata } from './Util';\n\nexport var Basemap = L.Layer.extend({\n  statics: {\n    URLPREFIX: 'https://www.arcgis.com/sharing/rest/content/items/',\n    URLSUFFIX: '/resources/styles/root.json',\n    STYLES: {\n      'OpenStreetMap': '3e1a00aeae81496587988075fe529f71',\n      // v2\n      'Streets': 'de26a3cf4cc9451298ea173c4b324736',\n      'StreetsRelief': 'b266e6d17fc345b498345613930fbd76',\n      // 7dc6cea0b1764a1f9af2e679f642f0f5 doesnt pass validation\n      'Topographic': '7a6bf0e8cb5a418085e66c0485e74d19',\n      // 86f556a2d1fd468181855a35e344567f doesnt pass validation\n      'StreetsNight': '93554006894c45a88136127535878fca',\n      'Newspaper': 'dfb04de5f3144a80bc3f9f336228d24a',\n      'Navigation': '63c47b7177f946b49902c24129b87252',\n      'Nova': '75f4dfdff19e445395653121a95a85db',\n      'ColoredPencil': '4cf7e1fb9f254dcda9c8fbadb15cf0f8',\n      'Hybrid': '30d6b8271e1849cd9c3042060001f425',\n      'Gray': '291da5eab3a0412593b66d384379f89f', // no labels\n      'DarkGray': '5e9b3685f4c24d8781073dd928ebda50', // no labels\n      'HumanGeography': '2afe5b807fa74006be6363fd243ffb30', // no labels\n      'HumanGeographyDetail': '97fa1365da1e43eabb90d0364326bc2d', // no labels\n      'DarkHumanGeography': 'd7397603e9274052808839b70812be50' // no labels\n      // 'ModernAntique': 'effe3475f05a4d608e66fd6eeb2113c0', // throws mismatched image size error\n    }\n  },\n\n  initialize: function (options) {\n    // L.Layer expects a JSON object literal to be passed in constructor\n    options = {\n      key: options\n    };\n\n    this._basemap = options.key;\n\n    if (typeof options.key === 'string' && Basemap.STYLES[options.key]) {\n      var url = Basemap.URLPREFIX + Basemap.STYLES[options.key] + Basemap.URLSUFFIX;\n      fetchMetadata(url, this);\n    } else {\n      throw new Error('L.esri.Vector.Basemap: Invalid parameter. Use one of \"DarkGray\", \"Gray\", \"Hybrid\", \"Navigation\", \"Streets\", \"StreetsNight\", \"StreetsRelief\", \"Topographic\"');\n    }\n  },\n\n  onAdd: function (map) {\n    this._map = map;\n    Util.setEsriAttribution(map);\n\n    if (map.attributionControl) {\n      if (this._basemap === 'OpenStreetMap') {\n        map.attributionControl.setPrefix('<a href=\"http://leafletjs.com\" title=\"A JS library for interactive maps\">Leaflet</a>');\n        map.attributionControl.addAttribution('<span class=\"esri-dynamic-attribution\">&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors, map layer by Esri</span>');\n      } else {\n        Util._getAttributionData('https://static.arcgis.com/attribution/World_Street_Map', map);\n        map.attributionControl.addAttribution('<span class=\"esri-dynamic-attribution\">USGS, NOAA</span>');\n      }\n    }\n\n    if (this._ready) {\n      this._asyncAdd();\n    } else {\n      this.once('ready', function () {\n        this._asyncAdd();\n      }, this);\n    }\n  },\n\n  onRemove: function (map) {\n    map.off('moveend', Util._updateMapAttribution);\n    map.removeLayer(this._mapboxGL);\n\n    if (map.attributionControl) {\n      var vectorAttribution = document.getElementsByClassName('esri-dynamic-attribution')[0].outerHTML;\n      // this doesn't work, not sure why.\n      map.attributionControl.removeAttribution(vectorAttribution);\n    }\n  },\n\n  _asyncAdd: function () {\n    var map = this._map;\n    // thought it was just me, but apparently its not easy to mixin two different styles\n    // https://github.com/mapbox/mapbox-gl-js/issues/4000\n\n    // set the background color of the map to the background color of the tiles\n    map.getContainer().style.background = this._mapboxGL.options.style.layers[0].paint['background-color'] || '#e1e3d0';\n\n    map.on('moveend', Util._updateMapAttribution);\n    this._mapboxGL.addTo(map, this);\n    // map._gl = this._mapboxGL;\n  }\n});\n\nexport function basemap (key) {\n  return new Basemap(key);\n}\n\nexport default Basemap;\n","import L from 'leaflet';\nimport { request, Util } from 'esri-leaflet';\nimport { fetchMetadata, formatStyle } from './Util';\n\nexport var Layer = L.Layer.extend({\n  statics: {\n    URLPREFIX: 'https://www.arcgis.com/sharing/rest/content/items/'\n  },\n\n  initialize: function (options) {\n    // L.Layer expects a JSON object literal to be passed in constructor\n    options = {\n      id: options\n    };\n\n    if (typeof options.id === 'string') {\n      var itemMetadataUrl = Layer.URLPREFIX + options.id;\n      var tileUrl;\n      var styleUrl;\n\n      request(itemMetadataUrl, {}, function (error, metadata) {\n        if (!error) {\n          tileUrl = metadata.url;\n\n          // custom tileset published using ArcGIS Pro\n          if (tileUrl.indexOf('basemaps.arcgis.com') === -1) {\n            this._customTileset = true;\n            // if copyright info was published, display it.\n            if (metadata.accessInformation) {\n              this._copyrightText = metadata.accessInformation;\n            }\n            request(tileUrl, {}, function (error, tileMetadata) {\n              if (!error) {\n                // right now ArcGIS Pro published vector services have a slightly different signature\n                if (tileMetadata.defaultStyles.charAt(0) !== '/') {\n                  tileMetadata.defaultStyles = '/' + tileMetadata.defaultStyles;\n                }\n\n                styleUrl = tileUrl + tileMetadata.defaultStyles + '/root.json';\n                request(styleUrl, {}, function (error, style) {\n                  if (!error) {\n                    formatStyle(style, tileMetadata, styleUrl);\n\n                    this._mapboxGL = L.mapboxGL({\n                      accessToken: 'ezree',\n                      style: style\n                    });\n\n                    this._ready = true;\n                    this.fire('ready', {}, true);\n                  }\n                }, this);\n              }\n            }, this);\n          } else {\n            // custom symbology applied to hosted basemap tiles\n            fetchMetadata(itemMetadataUrl + '/resources/styles/root.json', this);\n          }\n        }\n      }, this);\n    } else {\n      throw new Error('L.esri.Vector.Layer: Invalid parameter. Use the id of an ArcGIS Online vector tile item');\n    }\n  },\n\n  onAdd: function (map) {\n    this._map = map;\n    Util.setEsriAttribution(map);\n\n    if (this._ready) {\n      this._asyncAdd();\n    } else {\n      this.once('ready', function () {\n        this._asyncAdd();\n      }, this);\n    }\n  },\n\n  onRemove: function (map) {\n    map.off('moveend', Util._updateMapAttribution);\n    map.removeLayer(this._mapboxGL);\n\n    if (map.attributionControl) {\n      var vectorAttribution = document.getElementsByClassName('esri-dynamic-attribution')[0].outerHTML;\n      // this doesn't work, not sure why.\n      map.attributionControl.removeAttribution(vectorAttribution);\n    }\n  },\n\n  _asyncAdd: function () {\n    var map = this._map;\n    if (map.attributionControl) {\n      if (this._customTileset) {\n        if (this._copyrightText) {\n          // pull static copyright text for services published with Pro\n          map.attributionControl.addAttribution('<span class=\"esri-dynamic-attribution\">' + this._copyrightText + '</span>');\n        }\n      } else {\n        // provide dynamic attribution for Esri basemaps\n        Util._getAttributionData('https://static.arcgis.com/attribution/World_Street_Map', map);\n        map.attributionControl.addAttribution('<span class=\"esri-dynamic-attribution\">USGS, NOAA</span>');\n        map.on('moveend', Util._updateMapAttribution);\n      }\n    }\n\n    // set the background color of the map to the background color of the tiles\n    map.getContainer().style.background = this._mapboxGL.options.style.layers[0].paint['background-color'];\n    this._mapboxGL.addTo(map, this);\n  }\n});\n\nexport function layer (id) {\n  return new Layer(id);\n}\n\nexport default Layer;\n"],"names":["fetchMetadata","url","context","request","error","style","Error","sources","esri","tileMetadata","formatStyle","_mapboxGL","L","mapboxGL","accessToken","_ready","fire","metadata","styleUrl","indexOf","replace","tiles","charAt","tileMap","type","scheme","tilejson","format","tileInfo","index","description","name","glyphs","sprite","MapboxGL","Layer","extend","options","updateInterval","initialize","setOptions","this","mapboxgl","fn","time","lock","args","wrapperFn","later","_throttledUpdate","Util","bind","_update","apply","arguments","setTimeout","onAdd","map","_glContainer","_initContainer","_panes","tilePane","appendChild","_initGL","_offset","_map","containerPointToLayerPoint","zoomAnimation","DomEvent","on","_proxy","DomUtil","TRANSITION_END","_transitionEnd","onRemove","off","getPanes","removeChild","_glMap","remove","getEvents","move","zoomanim","_animateZoom","zoom","_pinchZoom","zoomstart","_zoomStart","zoomend","_zoomEnd","container","create","size","getSize","width","x","height","y","center","getCenter","interactive","lng","lat","getZoom","attributionControl","Map","transform","latRange","_canvas","canvas","_actualCanvas","addClass","e","_zooming","gl","topLeft","setPosition","tr","LngLat","convert","_resize","undefined","resize","update","jumpTo","scale","getZoomScale","offset","_latLngToNewLayerPoint","getBounds","getNorthWest","setTransform","subtract","requestAnimFrame","latLngToContainerPoint","once","Basemap","statics","URLPREFIX","URLSUFFIX","STYLES","OpenStreetMap","Streets","StreetsRelief","Topographic","StreetsNight","Newspaper","Navigation","Nova","ColoredPencil","Hybrid","Gray","DarkGray","HumanGeography","HumanGeographyDetail","DarkHumanGeography","key","_basemap","setEsriAttribution","setPrefix","addAttribution","_getAttributionData","_asyncAdd","_updateMapAttribution","removeLayer","vectorAttribution","document","getElementsByClassName","outerHTML","removeAttribution","getContainer","background","layers","paint","addTo","id","tileUrl","itemMetadataUrl","_customTileset","accessInformation","_copyrightText","defaultStyles"],"mappings":"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"}